version: '3.8'

services:
  argos-postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: argos
      POSTGRES_USER: argos
      POSTGRES_PASSWORD: ${ARGOS_DB_PASSWORD}
    volumes:
      - argos-db:/var/lib/postgresql/data
    networks:
      - argos-net
    restart: unless-stopped

  argos-server:
    image: argos-ci/argos:latest
    ports:
      - "4000:4000"
    environment:
      DATABASE_URL: postgresql://argos:${ARGOS_DB_PASSWORD}@argos-postgres:5432/argos
      APP_BASE_URL: https://argos.ozean-licht.dev
      JWT_SECRET: ${ARGOS_JWT_SECRET}
      GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID}
      GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET}
    depends_on:
      - argos-postgres
    networks:
      - argos-net
    restart: unless-stopped

volumes:
  argos-db:

networks:
  argos-net:
    driver: bridge
