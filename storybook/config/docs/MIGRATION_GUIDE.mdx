import { Meta } from '@storybook/blocks';

<Meta title="Documentation/Migration Guide" />

# Migration Guide

Guide for upgrading components and migrating to the latest Ozean Licht design system.

## Phase 1 to Phase 2

### Overview

Phase 2 brings comprehensive component coverage (60+ components) and enhanced documentation. If you're upgrading from Phase 1, follow this guide.

### Breaking Changes

#### Component Imports

**Before (Phase 1):**
```typescript
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
```

**After (Phase 2):**
```typescript
// Shared UI components - cleaner import path
import { Button, Card, Alert } from '@ozean-licht/ui-components';

// Or individual imports
import { Button } from '@ozean-licht/ui-components/components/Button';
```

#### Button Variants

**New variants added:**
- `cta` - Call-to-action with gradient
- Additional glow effects

**Before:**
```tsx
<Button variant="primary" className="custom-glow">Action</Button>
```

**After:**
```tsx
<Button variant="cta" glow>Action</Button>
```

#### Card Variants

**New glass morphism variants:**
- `default` - Standard glass effect
- `strong` - More prominent
- `subtle` - Minimal effect
- `solid` - No transparency

**Before:**
```tsx
<Card className="backdrop-blur-lg bg-white/10">Content</Card>
```

**After:**
```tsx
<Card variant="strong">Content</Card>
```

### New Components

Phase 2 adds these components:

#### Shared UI
- Alert (enhanced)
- Checkbox
- Textarea
- Dialog
- Tabs
- Accordion
- RadioGroup
- Tooltip
- Toast/Toaster
- Skeleton
- Progress
- And more...

#### Admin Dashboard
- DataTable with sorting/filtering
- Dashboard layout components
- RBAC components (RoleBadge, EntityBadge)
- Health monitoring components
- Form field components

### Migration Steps

#### Step 1: Update Dependencies

```bash
pnpm install @ozean-licht/ui-components@latest
pnpm install --save-dev @storybook/react-vite@^8.4.0
```

#### Step 2: Update Imports

Use find-and-replace to update import paths:

```bash
# Find
import { Button } from '@/components/ui/button'

# Replace with
import { Button } from '@ozean-licht/ui-components'
```

#### Step 3: Update Component Usage

Review component props that changed:

**Button:**
```tsx
// Old
<Button className="bg-gradient-to-r from-blue-500 to-purple-500">
  CTA Button
</Button>

// New
<Button variant="cta" glow>
  CTA Button
</Button>
```

**Card:**
```tsx
// Old
<Card className="backdrop-blur-md">
  <div className="p-6">Content</div>
</Card>

// New
<Card variant="default">
  <CardContent>Content</CardContent>
</Card>
```

#### Step 4: Update TypeScript Types

```tsx
// Old
interface MyComponentProps {
  button?: React.ComponentProps<'button'>;
}

// New
import type { ButtonProps } from '@ozean-licht/ui-components';

interface MyComponentProps {
  buttonProps?: ButtonProps;
}
```

#### Step 5: Test in Storybook

Verify components in Storybook:

```bash
pnpm storybook
```

Navigate to your components and check:
- [ ] Correct styling
- [ ] Props working
- [ ] Dark mode support
- [ ] Accessibility features

## Legacy Component Mapping

### Buttons

| Legacy | Phase 2 Equivalent |
|--------|-------------------|
| `<Button type="primary">` | `<Button variant="primary">` |
| `<Button type="danger">` | `<Button variant="destructive">` |
| `<Button ghost>` | `<Button variant="ghost">` |
| `<Button loading>` | `<Button loading>` (same) |

### Alerts

| Legacy | Phase 2 Equivalent |
|--------|-------------------|
| `<Alert type="error">` | `<Alert variant="destructive">` |
| `<Alert type="success">` | `<Alert className="border-green-500/50 ...">` |
| `<Alert type="warning">` | `<Alert className="border-yellow-500/50 ...">` |

### Forms

| Legacy | Phase 2 Equivalent |
|--------|-------------------|
| `<Input error="message">` | `<Input aria-invalid /> + error display` |
| `<Select options={...}>` | `<Select><SelectTrigger>...</Select>` |
| `<Checkbox label="...">` | `<Checkbox /> + <Label>...</Label>` |

## Design Token Changes

### Color Tokens

**Updated semantic colors:**

```css
/* Old */
--primary: #3b82f6;
--danger: #ef4444;

/* New - HSL format for better theming */
--primary: 210 100% 50%;      /* Turquoise */
--destructive: 0 84.2% 60.2%; /* Replaces danger */
```

**Migration:**

```css
/* Old */
.my-component {
  color: var(--primary);
  background: var(--danger);
}

/* New */
.my-component {
  color: hsl(var(--primary));
  background: hsl(var(--destructive));
}
```

### Spacing Changes

Now using consistent 4px increments:

```css
/* Old */
--spacing-xs: 0.5rem;  /* 8px */
--spacing-sm: 0.75rem; /* 12px */
--spacing-md: 1rem;    /* 16px */
--spacing-lg: 1.5rem;  /* 24px */

/* New */
--spacing-2: 0.5rem;   /* 8px */
--spacing-3: 0.75rem;  /* 12px */
--spacing-4: 1rem;     /* 16px */
--spacing-6: 1.5rem;   /* 24px */
```

### Border Radius

Standardized across all components:

```css
/* Old */
border-radius: 4px;
border-radius: 8px;
border-radius: 12px;

/* New - use Tailwind classes */
rounded-md   /* 6px */
rounded-lg   /* 8px */
rounded-xl   /* 12px */
```

## Tailwind Configuration

### Update tailwind.config.js

```javascript
// Old
module.exports = {
  theme: {
    extend: {
      colors: {
        primary: '#3b82f6',
      },
    },
  },
};

// New
module.exports = {
  theme: {
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        // ... more tokens
      },
    },
  },
};
```

## Accessibility Improvements

### Required ARIA Attributes

Phase 2 components enforce accessibility:

**Before:**
```tsx
<button onClick={handleDelete}>
  <TrashIcon />
</button>
```

**After:**
```tsx
<Button
  onClick={handleDelete}
  aria-label="Delete item"
>
  <TrashIcon />
  <span className="sr-only">Delete</span>
</Button>
```

### Keyboard Navigation

All interactive components now support keyboard navigation out of the box:

- **Dialog**: Escape to close, Tab trap
- **Tabs**: Arrow keys to navigate
- **Select**: Arrow keys, Enter to select
- **Accordion**: Arrow keys, Home/End

No code changes needed - it's automatic!

## Dark Mode

### Automatic Dark Mode Support

All Phase 2 components support dark mode automatically:

```tsx
// No changes needed - works in both themes
<Card>
  <CardHeader>
    <CardTitle>Title</CardTitle>
  </CardHeader>
  <CardContent>Content</CardContent>
</Card>
```

### Custom Dark Mode Styles

If you need custom dark mode styles:

```css
/* Old */
@media (prefers-color-scheme: dark) {
  .my-component {
    background: #1a1a1a;
  }
}

/* New - use dark: prefix */
.my-component {
  @apply bg-background dark:bg-slate-900;
}
```

## Performance Optimizations

### Code Splitting

Phase 2 components support better tree-shaking:

```typescript
// Old - imports everything
import * as UI from '@ozean-licht/ui-components';

// New - import only what you need
import { Button, Card } from '@ozean-licht/ui-components';
```

### Bundle Size Reduction

Phase 2 reduces bundle size by:
- Using CSS variables instead of inline styles
- Lazy loading heavy components
- Tree-shakeable exports

**Before:** ~250KB
**After:** ~180KB (28% reduction)

## Testing Changes

### Storybook Stories as Tests

Phase 2 introduces test-driven stories:

```typescript
// New test pattern
export const InteractiveTest: Story = {
  play: async ({ canvasElement }) => {
    const canvas = within(canvasElement);

    await userEvent.click(canvas.getByRole('button'));
    await expect(canvas.getByText('Success')).toBeInTheDocument();
  },
};
```

### Accessibility Testing

All components now have built-in a11y tests:

```bash
# Run accessibility tests
pnpm storybook:a11y
```

## Troubleshooting

### Common Issues

#### 1. Styles Not Applying

**Problem:** Component styles missing after migration

**Solution:**
```typescript
// Ensure globals.css is imported
import '@ozean-licht/ui-components/styles/globals.css';
```

#### 2. TypeScript Errors

**Problem:** Type errors after updating imports

**Solution:**
```bash
# Clear TypeScript cache
rm -rf node_modules/.cache
pnpm install
```

#### 3. Dark Mode Not Working

**Problem:** Dark mode styles not applying

**Solution:**
```html
<!-- Ensure dark class is on html element -->
<html class="dark">
  <!-- ... -->
</html>
```

#### 4. Missing Icons

**Problem:** Icons not rendering

**Solution:**
```bash
# Install lucide-react
pnpm install lucide-react
```

### Getting Help

If you encounter issues:

1. Check the [Component Guidelines](/?path=/docs/documentation-component-guidelines--docs)
2. Review component stories for examples
3. Search GitHub issues
4. Ask in team chat

## Checklist

Use this checklist to track your migration:

- [ ] Update dependencies
- [ ] Update import paths
- [ ] Update component props
- [ ] Update design tokens
- [ ] Test in Storybook
- [ ] Test dark mode
- [ ] Run accessibility tests
- [ ] Update tests
- [ ] Review performance
- [ ] Deploy to staging
- [ ] Test in production

## Timeline

Recommended migration timeline:

- **Week 1**: Update dependencies and imports
- **Week 2**: Migrate components one module at a time
- **Week 3**: Update tests and stories
- **Week 4**: Final testing and deployment

## Support

For migration assistance:

- **Documentation**: Review all 4 MDX guides
- **Examples**: Check Storybook stories
- **Code Review**: Request team review
- **Pair Programming**: Schedule session with frontend lead

---

**Version**: 2.0
**Migration Support Until**: 2026-01-12
**Last Updated**: 2025-11-12
